## Задача 1: API Gateway 

Предложите решение для обеспечения реализации API Gateway. Составьте сравнительную таблицу возможностей различных программных решений. На основе таблицы сделайте выбор решения.

Решение должно соответствовать следующим требованиям:
- маршрутизация запросов к нужному сервису на основе конфигурации,
- возможность проверки аутентификационной информации в запросах,
- обеспечение терминации HTTPS.

Обоснуйте свой выбор.

**Ответ.**

Все современные решения для API Gateway решают поставленные задачи, у меня выбор пал на Kong. 

#### Я выбрал Kong, потому что:

Kong является оптимальным выбором, потому что полностью соответствует требованиям ТЗ (маршрутизация, аутентификация, HTTPS). Высокая производительность и масштабируемость. Богатая экосистема плагинов. Гибкость развертывания (Kubernetes, облака, on-premise)

Kong API Gateway

Маршрутизация запросов:

- Динамическая конфигурация через REST API без перезагрузки
- Поддержка сложных сценариев (path-based, header-based, метод-based)
- Балансировка нагрузки (round-robin, least connections)

Аутентификация:

- Встроенные плагины для JWT, OAuth2.0, Key Auth, LDAP, OpenID Connect
- Поддержка кастомных плагинов на Lua/Python/Go
- Централизованное управление политиками доступа

HTTPS:

- Полная поддержка TLS 1.3
- Управление сертификатами через API
- Автоматическое обновление сертификатов (интеграция с Let's Encrypt)

Дополнительные преимущества:

- Производительность
- Экосистема

Гибкость развертывания:

- Kubernetes (Ingress Controller)
- Docker
- Bare metal

## Задача 2: Брокер сообщений

Составьте таблицу возможностей различных брокеров сообщений. На основе таблицы сделайте обоснованный выбор решения.

Решение должно соответствовать следующим требованиям:
- поддержка кластеризации для обеспечения надёжности,
- хранение сообщений на диске в процессе доставки,
- высокая скорость работы,
- поддержка различных форматов сообщений,
- разделение прав доступа к различным потокам сообщений,
- простота эксплуатации.

Обоснуйте свой выбор.

**Ответ.**

## Таблица возможностей

| Характеристика / Брокер       | RabbitMQ | Kafka | ActiveMQ | Redis (Streams) | NATS (JetStream) |
|-------------------------------|----------|-------|----------|-----------------|------------------|
| Кластеризация                 | +        | +     | +        | +               | +                |
| Хранение на диске              | +        | +     | +        | ±               | +                |
| Высокая скорость               | +        | ++    | ±        | +               | ++               |
| Поддержка форматов            | +        | +     | +        | +               | +                |
| Разделение прав доступа       | +        | +     | +        | ±               | +                |
| Простота эксплуатации         | +        | ±     | ±        | +               | +                |



---

## Выбранное решение: RabbitMQ

### Обоснование выбора

Лучше всего для решения нашей задачи подойдет RabbitM, причины ниже.

#### 1. Поддержка кластеризации для обеспечения надёжности
- Реализована надежная кластеризация.
- Поддержка **зеркалирования очередей ** между узлами.
- Автоматическое восстановление при сбоях узлов.

#### 2. Хранение сообщений на диске в процессе доставки
- Поддержка **персистентных сообщений**, которые сохраняются на диск и не теряются при перезагрузке.
- Механизм **подтверждения доставки** гарантирует, что сообщения приняты брокером.
- Гибкие политики хранения и TTL.

#### 3. Высокая скорость работы
- Производительность до **50 000+ сообщений в секунду** на одном узле.
- Поддержка **lazy queues**, которые выгружают сообщения на диск при нехватке памяти, снижая нагрузку.
- Оптимизация для сценариев с высокой частотой обмена сообщениями.


#### 4. Простота эксплуатации
- Встроенный **веб-интерфейс управления** (RabbitMQ Management Plugin) для мониторинга, настройки и диагностики.
- Наличие CLI-инструментов, REST API и SDK для множества языков.
- **Подробная документация**, активное сообщество и широкая поддержка в DevOps-экосистеме.

---


## Задача 3: API Gateway * (необязательная)

#### Весь проект основывал на https://github.com/netology-code/devkub-homeworks/tree/main/11-microservices-02-principles допиливая под себя и решая проблемы с нерабочими контейнерами. Запуск и получения токена прошли успешно (хоть токен и вывелся немного коряво)

<img width="1683" height="262" alt="micro_homework-1" src="https://github.com/user-attachments/assets/dba32228-1524-4a4c-86e9-8b12a2d74056" />


```
root@ubuntulearn:/home/devkub-homeworks/11-microservices-02-principles# curl -X POST -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJib2IifQ.-51G5JQmpJleARHp8rIljBczPFanWT93d_N_7LQGUXU' -H 'Content-Type: octet/stream' --data-binary @1.jpg http://localhost/v1/upload
{"filename":"e0de8db9-ad02-4eb9-a5d1-624a65581b8c.jpg"}
```

Загрузить картинку и проверить что она открывается:
```
curl localhost/image/e0de8db9-ad02-4eb9-a5d1-624a65581b8c.jpg > e0de8db9-ad02-4eb9-a5d1-624a65581b8c.jpg65581b8c.jpg 
```

```
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   153  100   153    0     0   152k      0 --:--:-- --:--:-- --:--:--  149k

root@ubuntulearn:/home/devkub-homeworks/11-microservices-02-principles# ls -l 
total 96
-rw-r--r-- 1 root root 69846 Oct  8  2013 1.jpg
-rw-rw-rw- 1 root root  1915 Aug 25 10:18 docker-compose.yaml
-rw-r--r-- 1 root root   153 Aug 25 10:20 e0de8db9-ad02-4eb9-a5d1-624a65581b8c.jpg
drwxr-xr-x 2 root root  4096 Aug 25 04:47 gateway
-rw-r--r-- 1 root root  1719 Aug 25 03:31 readme.md
drwxr-xr-x 3 root root  4096 Aug 25 04:26 security
drwxr-xr-x 3 root root  4096 Aug 25 03:31 uploader
```

<img width="1678" height="376" alt="micro_homework-1 2" src="https://github.com/user-attachments/assets/4c654346-e684-4f01-b0d1-e839765f0a3f" />

